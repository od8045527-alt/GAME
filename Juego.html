<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dino Mobile Fix</title>
    <style>
        :root { --bg: #f0f9ff; --text: #333; --accent: #2ecc71; }
        .night { --bg: #0f172a; --text: #f8fafc; --accent: #00d2d3; }

        body {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100vh; margin: 0; background-color: var(--bg); color: var(--text);
            font-family: sans-serif; transition: all 1s; overflow: hidden;
            /* IMPORTANTE: Evita que el m칩vil refresque al deslizar hacia abajo */
            overscroll-behavior-y: contain;
            touch-action: none; 
        }

        #score-container { font-size: 24px; font-weight: bold; margin-bottom: 10px; z-index: 20; }

        .game-area {
            width: 95vw; max-width: 600px; height: 200px; position: relative;
            border-bottom: 3px solid var(--text); background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        #dino {
            position: absolute; bottom: 0; left: 40px; font-size: 40px;
            transform: scaleX(-1); z-index: 10;
        }

        .duck { transform: scaleX(-1) scaleY(0.5) !important; bottom: -10px !important; color: var(--accent); }

        .obstacle { 
            position: absolute; right: -100px; font-size: 30px; 
            animation: move-obs 2.2s infinite linear; z-index: 10;
        }
        #cactus { bottom: 0; }
        #bird { bottom: 35px; }

        @keyframes move-obs { from { right: -100px; } to { right: 115%; } }

        .jump { animation: jump-anim 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes jump-anim { 0%, 100% { bottom: 0; } 50% { bottom: 100px; } }

        /* Gu칤a visual para m칩vil */
        .touch-zones {
            position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; z-index: 5;
        }
        .zone { flex: 1; opacity: 0.1; }
    </style>
</head>
<body id="body">

    <div id="score-container">00000</div>
    
    <div class="game-area" id="gameArea">
        <div class="touch-zones">
            <div id="jump-zone" class="zone"></div>
            <div id="duck-zone" class="zone"></div>
        </div>

        <div id="dino">游붔</div>
        <div id="cactus" class="obstacle">游꺗</div>
        <div id="bird" class="obstacle" style="display: none;">游분</div>
    </div>

    <p style="font-size: 10px; margin-top: 10px;">ARRIBA: SALTAR | ABAJO: AGACHAR</p>

    <script>
        const dino = document.getElementById("dino");
        const cactus = document.getElementById("cactus");
        const bird = document.getElementById("bird");
        const body = document.getElementById("body");
        const scoreDisplay = document.getElementById("score-container");
        
        let score = 0;
        let gameActive = true;
        let type = "ground";

        // --- FUNCIONES DE ACCI칍N ---
        function jump() {
            if (gameActive && !dino.classList.contains("jump") && !dino.classList.contains("duck")) {
                dino.classList.add("jump");
                setTimeout(() => dino.classList.remove("jump"), 600);
            }
        }

        function duck(active) {
            if (gameActive) {
                if (active) dino.classList.add("duck");
                else dino.classList.remove("duck");
            }
        }

        // --- EVENTOS M칍VIL (Touch) ---
        document.addEventListener("touchstart", (e) => {
            if (!gameActive) return;
            // e.preventDefault(); // Detiene el scroll del m칩vil
            const touchY = e.touches[0].clientY;
            const screenHeight = window.innerHeight;

            if (touchY < screenHeight / 2) {
                jump();
            } else {
                duck(true);
            }
        }, { passive: false });

        document.addEventListener("touchend", () => duck(false));

        // --- EVENTOS PC (Teclado) ---
        window.addEventListener("keydown", (e) => {
            if (e.code === "Space" || e.code === "ArrowUp") jump();
            if (e.code === "ArrowDown") duck(true);
        });
        window.addEventListener("keyup", (e) => {
            if (e.code === "ArrowDown") duck(false);
        });

        // --- L칍GICA DE OBST츼CULOS ---
        function switchObj() {
            if (!gameActive) return;
            if (type === "ground") {
                cactus.style.display = "none";
                bird.style.display = "block";
                type = "air";
            } else {
                const count = Math.floor(Math.random() * 3) + 1;
                cactus.innerHTML = "游꺗".repeat(count);
                bird.style.display = "none";
                cactus.style.display = "block";
                type = "ground";
            }
        }

        cactus.addEventListener('animationiteration', switchObj);
        bird.addEventListener('animationiteration', switchObj);

        // --- BUCLE DE COLISI칍N ---
        setInterval(() => {
            if (!gameActive) return;

            score += 0.15;
            let val = Math.floor(score);
            scoreDisplay.innerHTML = val.toString().padStart(5, '0');

            // D칤a y Noche
            if (val % 200 >= 100) body.classList.add("night");
            else body.classList.remove("night");

            let d = dino.getBoundingClientRect();
            let obs = (type === "ground") ? cactus.getBoundingClientRect() : bird.getBoundingClientRect();

            if (d.left < obs.right - 15 && d.right > obs.left + 15) {
                if (type === "ground" && d.bottom > obs.top + 10) gameOver();
                if (type === "air" && (d.top < obs.bottom - 10 && d.bottom > obs.top + 10)) gameOver();
            }
        }, 20);

        function gameOver() {
            gameActive = false;
            alert("GAME OVER - Score: " + Math.floor(score));
            location.reload();
        }
    </script>
</body>
</html>